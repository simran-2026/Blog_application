<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head') %>
  <title>Blog</title>
  <style>
    body{background:#f7f9fc}
    .page-wrap{max-width: 900px; margin: 2rem auto}
    .card-glass{
      background:#fff;
      border-radius:16px;
      box-shadow:0 10px 24px rgba(0,0,0,.08);
      border:1px solid rgba(0,0,0,.06);
    }
    .post-hero{
      border-radius:14px;
      overflow:hidden;
    }
    .post-cover{
      width:100%;
      max-height:460px;
      object-fit:cover;
      display:block;
    }
    .post-title{
      font-weight:800;
      letter-spacing:.2px;
      line-height:1.2;
    }
    .post-body{
      white-space:pre-wrap; /* like <pre> but wraps nicely */
      font-size:1.05rem;
      line-height:1.8;
      color:#26323f;
    }
    .author-chip{
      display:flex; align-items:center; gap:.8rem;
      padding:.75rem 1rem; border-radius:999px;
      background:#fff; border:1px solid rgba(0,0,0,.06);
      box-shadow:0 6px 16px rgba(0,0,0,.06);
      width:fit-content;
    }
    .avatar{
      width:44px; height:44px; border-radius:50%; object-fit:cover;
      border:2px solid #fff; box-shadow:0 2px 10px rgba(0,0,0,.08)
    }
    .comment-card{
      border-radius:14px; padding:1rem 1.2rem;
      background:#fff; border:1px solid rgba(0,0,0,.06);
      box-shadow:0 8px 18px rgba(0,0,0,.06);
    }
    .comment-text{white-space:pre-wrap; margin: .25rem 0 0}
    .section-title{
      font-weight:700; letter-spacing:.3px;
    }
    .btn-primary{
      background:linear-gradient(135deg,#4e73df,#224abe);
      border:none; font-weight:600; transition:.25s;
    }
    .btn-primary:hover{transform:translateY(-2px)}
  </style>
</head>
<body>
  <%- include('./partials/nav') %>

  <div class="container page-wrap">

    <!-- Post -->
    <article class="card-glass p-4 p-md-5">
      <h1 class="post-title mb-3"><%= blog.title %></h1>

      <div class="post-hero mb-4">
        <img src="<%= blog.coverImageURL %>" alt="Cover" class="post-cover">
      </div>

      <div class="d-flex align-items-center gap-3 mb-4">
        <div class="author-chip">
          <img src="<%= blog.createdBy.profileImageURL %>" alt="Author" class="avatar">
          <div class="small">
            <div class="fw-semibold"><%= blog.createdBy.fullName %></div>
            <!-- Add a date if available e.g., <div class="text-muted">Published <%= blog.createdAtFormatted %></div> -->
          </div>
        </div>
      </div>

      <div class="post-body"><%= blog.body %></div>
    </article>

    <!-- Comments -->
    <section class="mt-5">
      <div class="d-flex align-items-end justify-content-between mb-3">
        <h2 class="section-title h4 mb-0">Comments (<%= comments.length %>)</h2>
      </div>

      <% if (locals.user) { %>
      <form action="/blog/comment/<%= blog._id %>" method="post" class="card-glass p-3 p-md-4 mb-4">
        <div class="mb-3">
          <input type="text" name="content" class="form-control form-control-lg" placeholder="Add a commentâ€¦" required>
        </div>
        <div class="text-end">
          <button class="btn btn-primary px-4" type="submit">Add Comment</button>
        </div>
      </form>
      <% } %>

      <div class="d-flex flex-column gap-3">
        <% comments.forEach(comment => { %>
          <div class="comment-card">
            <div class="d-flex align-items-center gap-2 mb-1">
              <img src="<%= comment.createdBy.profileImageURL %>" class="avatar" alt="User">
              <div class="fw-semibold"><%= comment.createdBy.fullName %></div>
            </div>
            <div class="comment-text"><%= comment.content %></div>
          </div>
        <% }) %>
      </div>
    </section>

  </div>

  <%- include('./partials/scripts') %>
</body>
</html>
